(()=>{var e={427:(e,t,r)=>{r(142).config(),r(185).connect(process.env.MONGOOSE_URL)},954:(e,t,r)=>{const i=r(738),s=i.diskStorage({}),n=i({storage:s,fileFilter:(e,t,r)=>{"image/jpeg"===t.mimetype||"image/png"===t.mimetype?r(null,!0):r({message:"Unsopported file format"},!1)}});e.exports=n},882:(e,t,r)=>{const i=r(185),s=new i.Schema({name:{type:String,required:!0},email:{type:String,required:!0},passwort:{type:String,required:!0},publicId:String,imageUrl:String,radius:Number}),n=new i.Schema({lng:Number,lat:Number,country:String,city:String}),o=new i.Schema({name:{type:String,required:!0},description:String,location:n,type:String,publicImageId:String,imageUrl:String,userId:String},{timestamps:!0}),a=i.model("User",s),c=i.model("Location",n),u=i.model("Warning",o);e.exports={Warning:u,Location:c,User:a}},317:(e,t,r)=>{r(142).config();const i=r(518);i.config({cloud_name:process.env.CLOUD_NAME,api_key:process.env.API_KEY,api_secret:process.env.API_SECRET}),uploadToCloudinary=(e,t)=>i.v2.uploader.upload(e,{folder:t}).then((e=>({imageUrl:e.url,publicId:e.public_id}))).catch((e=>{console.log(e)})),e.exports=uploadToCloudinary},518:e=>{"use strict";e.exports=require("cloudinary")},142:e=>{"use strict";e.exports=require("dotenv")},860:e=>{"use strict";e.exports=require("express")},185:e=>{"use strict";e.exports=require("mongoose")},738:e=>{"use strict";e.exports=require("multer")}},t={};function r(i){var s=t[i];if(void 0!==s)return s.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,r),n.exports}(()=>{const e=r(860),{Warning:t,Location:i,User:s}=r(882),n=r(317),o=r(954);r(427);const a=e();a.use(e.json()),a.use(e.urlencoded({extended:!0})),a.set("view engine","ejs"),a.set("views","./views"),a.use(e.static("public")),a.get("/",(async(e,t)=>{try{t.render("home")}catch(e){t.status(400).send(e)}})),a.get("/api/warnings",(async(e,r)=>{try{const e=await t.find();r.json(e)}catch(e){r.status(400).send(e)}})),a.post("/add-warning",o.single("image"),(async(e,r)=>{try{const o=await s.findById("637e89a5dae3e5065e2d2042"),a=new t({...e.body,userId:o._id}),c=await a.save(),u=new i(e.body),d=await n(e.file.path,"warnings");await t.updateOne({_id:c._id},{$set:{location:u,imageUrl:d.imageUrl,publicImageId:d.publicId}}),r.status(200).send("New warning was posted successfully.")}catch(e){console.log(e),r.status(400).send(e)}})),a.listen(3e3,(()=>{console.log("Server is running on port 3000.")}))})()})();